<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Pre Press Monitoring System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/themes/material_blue.css">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 10px;
      transition: all 0.5s ease;
      position: relative;
      overflow-x: hidden;
      -webkit-tap-highlight-color: transparent;
    }

    body.dark-mode {
      background: #0a0a0a;
      color: #f0e6d2;
    }

    .theme-toggle {
      position: fixed;
      top: 10px;
      right: 10px;
      z-index: 1000;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      backdrop-filter: blur(5px);
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .theme-toggle:hover {
      transform: scale(1.1);
      background: rgba(255, 255, 255, 0.3);
    }

    .theme-toggle svg {
      width: 22px;
      height: 22px;
      transition: all 0.5s ease;
    }

    .theme-toggle .sun { color: #ffd700; }
    .theme-toggle .moon {
      color: #f0e6d2;
      opacity: 0;
      position: absolute;
      transform: rotate(-90deg);
    }

    body.dark-mode .theme-toggle .sun {
      opacity: 0;
      transform: rotate(90deg);
    }

    body.dark-mode .theme-toggle .moon {
      opacity: 1;
      transform: rotate(0deg);
    }

    body.dark-mode .container {
      background: #1a1a1a;
      border: 2px solid #d4af37;
      box-shadow: 0 20px 60px rgba(212, 175, 55, 0.2);
    }

    body.dark-mode .header {
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border-bottom: 2px solid #d4af37;
    }

    body.dark-mode .controls {
      background: #2a2a2a;
      border-bottom: 2px solid #d4af37;
    }

    body.dark-mode .control-group label { color: #f0e6d2; }

    body.dark-mode input[type="text"].date-input {
      background: #1a1a1a;
      border: 2px solid #d4af37;
      color: #f0e6d2;
    }

    body.dark-mode input[type="text"].date-input:focus {
      border-color: #ffd700;
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.15);
    }

    body.dark-mode .calendar-icon { color: #d4af37; }

    body.dark-mode .press-btn {
      background: #1a1a1a;
      border: 2px solid #d4af37;
      color: #f0e6d2;
    }

    body.dark-mode .press-btn.active {
      background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
      color: #1a1a1a;
      border-color: #ffd700;
    }

    body.dark-mode .section {
      background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
      border-bottom: 2px solid #d4af37;
    }

    body.dark-mode table {
      background: #1a1a1a;
      border: 1px solid #d4af37;
    }

    body.dark-mode thead {
      background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
    }

    body.dark-mode tbody tr { border-bottom: 1px solid #333; }

    body.dark-mode tbody tr:hover {
      background: rgba(212, 175, 55, 0.1);
      box-shadow: 0 2px 8px rgba(212, 175, 55, 0.2);
    }

    body.dark-mode tbody td { color: #f0e6d2; }

    body.dark-mode .stats { background: #2a2a2a; }

    body.dark-mode .stat-card {
      background: #1a1a1a;
      border: 1px solid #d4af37;
      color: #f0e6d2;
    }

    body.dark-mode .stat-card h3 { color: #d4af37; }
    body.dark-mode .stat-card .value { color: #ffd700; }

    .firefly {
      position: fixed;
      width: 4px;
      height: 4px;
      background: #ffd700;
      border-radius: 50%;
      filter: blur(1px);
      box-shadow: 0 0 10px 2px #ffd700;
      opacity: 0;
      z-index: 10;
      pointer-events: none;
    }

    .orb {
      position: fixed;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(212,175,55,0.4) 0%, rgba(212,175,55,0) 70%);
      filter: blur(5px);
      opacity: 0.3;
      z-index: 10;
      pointer-events: none;
    }

    .meteor {
      position: fixed;
      width: 2px;
      height: 50px;
      background: linear-gradient(to bottom, transparent, #ffd700);
      transform: rotate(-45deg);
      opacity: 0;
      z-index: 10;
      pointer-events: none;
    }

    body.dark-mode { cursor: none; }

    .lantern-cursor {
      position: fixed;
      width: 40px;
      height: 60px;
      pointer-events: none;
      z-index: 9999;
      opacity: 0;
      transition: opacity 0.3s;
    }

    body.dark-mode .lantern-cursor { opacity: 1; }

    .lantern-body {
      width: 30px;
      height: 50px;
      background: radial-gradient(ellipse at center, #d4af37 0%, #8b6914 100%);
      border-radius: 15px 15px 5px 5px;
      position: relative;
      margin: 0 auto;
      box-shadow: 0 0 20px 5px rgba(212, 175, 55, 0.7);
    }

    .lantern-top, .lantern-bottom {
      width: 35px;
      height: 5px;
      background: #d4af37;
      border-radius: 5px;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    .lantern-top { top: -5px; }
    .lantern-bottom { bottom: -5px; }

    .lantern-light {
      position: absolute;
      bottom: -30px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 80px;
      background: radial-gradient(ellipse at center, rgba(255,215,0,0.6) 0%, rgba(255,215,0,0) 70%);
      border-radius: 50%;
      filter: blur(10px);
    }

    .repel-effect {
      position: fixed;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,215,0,0.4) 0%, rgba(255,215,0,0) 70%);
      pointer-events: none;
      z-index: 9998;
      opacity: 0;
    }

    body.dark-mode ::-webkit-scrollbar-thumb { background: #d4af37; }
    body.dark-mode ::-webkit-scrollbar-thumb:hover { background: #b8941f; }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-thumb {
      background: #a1a1a1;
      border-radius: 10px;
    }
    ::-webkit-scrollbar-thumb:hover { background: #7f7f7f; }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      transition: all 0.5s ease;
      position: relative;
      z-index: 2;
    }

    .header {
      background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
      padding: 20px 15px;
      text-align: center;
      transition: all 0.5s ease;
    }

    .header h1 {
      color: white;
      font-size: 1.6em;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      margin-bottom: 8px;
    }

    .datetime {
      color: white;
      font-size: 0.95em;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    }

    .controls {
      background: #f8f9fa;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      border-bottom: 3px solid #e9ecef;
      transition: all 0.5s ease;
    }

    .date-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: flex-end;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
      flex: 1;
      min-width: 140px;
    }

    .control-group label {
      font-weight: 600;
      color: #495057;
      font-size: 0.9em;
    }

    .date-input-wrapper {
      position: relative;
      display: block;
      width: 100%;
    }

    input[type="text"].date-input {
      padding: 12px 40px 12px 12px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      font-size: 16px;
      transition: 0.3s;
      width: 100%;
      cursor: pointer;
      background: white;
      -webkit-appearance: none;
      appearance: none;
    }

    input[type="text"].date-input:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
      outline: none;
    }

    .calendar-icon {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      stroke-width: 1.8;
      color: #495057;
      cursor: pointer;
      pointer-events: none;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      min-height: 44px;
      touch-action: manipulation;
    }

    .btn-view {
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
      flex-shrink: 0;
    }

    .btn-view:hover, .btn-view:active {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(17, 153, 142, 0.4);
    }

    .btn-export {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 10px 16px;
      font-size: 0.85em;
    }

    .btn-export:hover, .btn-export:active {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .press-selector {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
    }

    .press-btn {
      padding: 10px 12px;
      border: 2px solid #dee2e6;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      transition: 0.3s;
      font-weight: 600;
      color: #495057;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 0.85em;
      min-height: 44px;
      touch-action: manipulation;
    }

    .press-btn.active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-color: #667eea;
      transform: scale(1.02);
    }

    .press-btn:hover, .press-btn:active {
      transform: translateY(-1px);
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
    }

    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      display: inline-block;
      flex-shrink: 0;
    }

    .status-working {
      background: #28a745;
      animation: pulse-glow 2s ease-in-out infinite;
      box-shadow: 0 0 8px #28a745;
    }

    .status-idle {
      background: #dc3545;
      box-shadow: 0 0 4px #dc3545;
    }

    @keyframes pulse-glow {
      0%, 100% {
        opacity: 1;
        box-shadow: 0 0 8px #28a745;
      }
      50% {
        opacity: 0.6;
        box-shadow: 0 0 14px #28a745;
      }
    }

    .section {
      background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
      padding: 15px;
      transition: all 0.5s ease;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 10px;
    }

    .section h2 {
      color: white;
      font-size: 1.3em;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
    }

    .loading {
      text-align: center;
      padding: 30px;
      color: #6c757d;
      font-size: 1.1em;
    }

    .loading-quote {
      font-style: italic;
      margin-top: 15px;
      font-size: 1em;
      min-height: 1.5em;
      animation: fadeInQuote 0.5s ease, colorShift 3s ease-in-out infinite;
      background: linear-gradient(90deg, #667eea, #764ba2, #f6d365, #fda085, #11998e, #667eea);
      background-size: 300% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 600;
    }

    @keyframes fadeInQuote {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @keyframes colorShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    body.dark-mode .loading {
      color: #d4af37;
    }

    body.dark-mode .loading-quote {
      background: linear-gradient(90deg, #ffd700, #d4af37, #fff5cc, #d4af37, #ffd700);
      background-size: 300% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      animation: spin 1s linear infinite;
      margin: 15px auto;
    }

    @keyframes spin { to { transform: rotate(360deg); } }

    .table-container {
      padding: 15px;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.5s ease;
      min-width: 500px;
    }

    thead {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    thead th {
      color: white;
      padding: 12px 10px;
      text-align: left;
      font-size: 0.85em;
      text-transform: uppercase;
    }

    thead th small {
      font-size: 0.75em;
      font-weight: normal;
      opacity: 0.9;
    }

    tbody tr {
      border-bottom: 1px solid #e9ecef;
      transition: background 0.4s ease;
    }

    tbody tr:hover {
      background: rgba(102, 126, 234, 0.05);
    }

    tbody tr.in-progress {
      background: rgba(33, 150, 243, 0.15);
      animation: fade-glow 2.5s ease-in-out infinite;
    }

    @keyframes fade-glow {
      0%, 100% { background: rgba(33, 150, 243, 0.15); }
      50% { background: rgba(33, 150, 243, 0.35); }
    }

    tbody tr.success {
      background: linear-gradient(90deg, rgba(40, 167, 69, 0.15), rgba(40, 167, 69, 0));
    }

    tbody tr.warning {
      background: linear-gradient(90deg, rgba(255, 193, 7, 0.2), rgba(255, 193, 7, 0));
    }

    tbody tr.danger {
      background: linear-gradient(90deg, rgba(220, 53, 69, 0.25), rgba(220, 53, 69, 0));
      animation: danger-pulse 3s ease-in-out infinite;
    }

    @keyframes danger-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    tbody td {
      padding: 12px 10px;
      color: #495057;
      font-size: 0.9em;
    }

    .duration {
      font-weight: 700;
      font-size: 1em;
    }

    .duration.success { color: #28a745; }
    .duration.in-progress { color: #2196f3; }
    .duration.warning { color: #ffc107; }
    .duration.danger { color: #dc3545; }

    .idle-time {
      font-weight: 600;
      color: #6c757d;
    }

    .no-data {
      text-align: center;
      padding: 40px 15px;
      color: #6c757d;
      font-size: 1.1em;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      padding: 15px;
      background: #f8f9fa;
      transition: all 0.5s ease;
    }

    .stat-card {
      background: white;
      padding: 12px 8px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      transition: 0.3s;
    }

    .stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
    }

    .stat-card h3 {
      color: #6c757d;
      font-size: 0.7em;
      margin-bottom: 3px;
      text-transform: uppercase;
    }

    .stat-card .subtitle {
      color: #9ca3af;
      font-size: 0.6em;
      margin-bottom: 6px;
    }

    .stat-card .value {
      font-size: 1.2em;
      font-weight: bold;
      color: #667eea;
    }

    .all-presses-container {
      display: grid;
      grid-template-columns: 1fr;
      gap: 15px;
      padding: 10px;
    }

    .mini-table-container {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      border: 1px solid #dee2e6;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .mini-table-container:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.2);
    }

    .mini-table-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 15px;
      font-weight: bold;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.95em;
    }

    .mini-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8em;
      background: white;
    }

    .mini-table th {
      background: #f8f9fa;
      padding: 10px 8px;
      text-align: left;
      font-weight: 600;
      color: #495057;
      border-bottom: 1px solid #dee2e6;
      text-transform: uppercase;
      font-size: 0.85em;
      letter-spacing: 0.3px;
    }

    .mini-table td {
      padding: 10px 8px;
      border-bottom: 1px solid #e9ecef;
      color: #495057;
    }

    .mini-table tr:last-child td { border-bottom: none; }

    .mini-table tr:hover {
      background: rgba(102, 126, 234, 0.05);
    }

    .mini-table .duration {
      font-weight: 600;
      font-size: 0.9em;
    }

    .more-entries {
      text-align: center;
      padding: 12px;
      color: #667eea;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
      background: rgba(102, 126, 234, 0.05);
      border-top: 1px solid #e9ecef;
    }

    .more-entries:hover, .more-entries:active {
      background: rgba(102, 126, 234, 0.1);
      color: #5a67d8;
    }

    /* Dark mode mini tables */
    body.dark-mode .mini-table-container {
      background: #1a1a1a;
      border: 2px solid #d4af37;
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.15);
    }

    body.dark-mode .mini-table-container:hover {
      box-shadow: 0 6px 20px rgba(212, 175, 55, 0.25);
    }

    body.dark-mode .mini-table-header {
      background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
      color: #1a1a1a;
    }

    body.dark-mode .mini-table {
      background: #1a1a1a;
    }

    body.dark-mode .mini-table th {
      background: #2a2a2a;
      color: #d4af37;
      border-bottom: 1px solid #d4af37;
    }

    body.dark-mode .mini-table td {
      border-bottom: 1px solid #333;
      color: #f0e6d2;
    }

    body.dark-mode .mini-table tr:hover {
      background: rgba(212, 175, 55, 0.1);
    }

    body.dark-mode .more-entries {
      color: #d4af37;
      background: rgba(212, 175, 55, 0.1);
      border-top: 1px solid #333;
    }

    body.dark-mode .more-entries:hover, body.dark-mode .more-entries:active {
      background: rgba(212, 175, 55, 0.2);
      color: #ffd700;
    }

    .all-press-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      padding: 10px;
    }

    .all-stat-card {
      background: white;
      padding: 15px 12px;
      border-radius: 10px;
      text-align: center;
      border: 1px solid #dee2e6;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .all-stat-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.2);
    }

    .all-stat-card h4 {
      color: #6c757d;
      font-size: 0.75em;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .all-stat-card .value {
      font-size: 1.3em;
      font-weight: bold;
      color: #667eea;
    }

    /* Dark mode all-stat-cards */
    body.dark-mode .all-stat-card {
      background: #1a1a1a;
      border: 2px solid #d4af37;
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.15);
    }

    body.dark-mode .all-stat-card:hover {
      box-shadow: 0 6px 20px rgba(212, 175, 55, 0.25);
    }

    body.dark-mode .all-stat-card h4 {
      color: #d4af37;
    }

    body.dark-mode .all-stat-card .value {
      color: #ffd700;
      text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
    }

    /* Flatpickr mobile fixes */
    .flatpickr-calendar {
      font-size: 14px !important;
    }

    .flatpickr-day {
      height: 40px !important;
      line-height: 40px !important;
    }

    .flatpickr-months {
      padding: 5px 0 !important;
    }

    @media (min-width: 768px) {
      body { padding: 20px; }

      .header { padding: 30px; }
      .header h1 { font-size: 2.2em; }
      .datetime { font-size: 1.2em; }

      .controls { padding: 20px; }

      .date-controls {
        flex-wrap: nowrap;
      }

      .control-group { min-width: 160px; }

      .press-selector {
        grid-template-columns: repeat(6, auto);
      }

      .press-btn {
        padding: 10px 18px;
        font-size: 0.9em;
      }

      .section { padding: 20px 30px; }
      .section h2 { font-size: 1.8em; }

      .table-container { padding: 30px; }

      table { min-width: auto; }

      thead th {
        padding: 18px;
        font-size: 1em;
      }

      tbody td {
        padding: 15px 18px;
        font-size: 1em;
      }

      .stats {
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
        padding: 30px;
      }

      .stat-card {
        padding: 20px;
      }

      .stat-card h3 { font-size: 0.9em; }
      .stat-card .value { font-size: 1.5em; }

      .all-presses-container {
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
        padding: 20px;
      }

      .all-press-stats {
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        padding: 20px;
      }
    }

    @media (min-width: 1024px) {
      .all-presses-container {
        grid-template-columns: repeat(3, 1fr);
      }
    }
  </style>
</head>
<body>
  <div class="theme-toggle" id="themeToggle">
    <svg class="sun" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
    <svg class="moon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </div>

  <div class="lantern-cursor" id="lanternCursor">
    <div class="lantern-top"></div>
    <div class="lantern-body"></div>
    <div class="lantern-bottom"></div>
    <div class="lantern-light"></div>
  </div>

  <div class="container">
    <div class="header">
      <h1>Pre Press Monitoring System</h1>
      <div class="datetime" id="currentDateTime"></div>
    </div>

    <div class="controls">
      <div class="date-controls">
        <div class="control-group">
          <label>From Date:</label>
          <div class="date-input-wrapper">
            <input type="text" class="date-input" id="fromDate" placeholder="DD/MM/YYYY" readonly />
            <svg class="calendar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
          </div>
        </div>
        <div class="control-group">
          <label>To Date:</label>
          <div class="date-input-wrapper">
            <input type="text" class="date-input" id="toDate" placeholder="DD/MM/YYYY" readonly />
            <svg class="calendar-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
              <line x1="16" y1="2" x2="16" y2="6"></line>
              <line x1="8" y1="2" x2="8" y2="6"></line>
              <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
          </div>
        </div>
        <button class="btn btn-view" onclick="loadData()">VIEW</button>
      </div>
      <div class="control-group">
        <label>Select Press:</label>
        <div class="press-selector" id="pressButtons"></div>
      </div>
    </div>

    <div class="stats" id="statsContainer">
      <div class="stat-card">
        <h3>Total Presses</h3>
        <div class="value" id="totalPresses">0</div>
      </div>
      <div class="stat-card">
        <h3>Avg Duration</h3>
        <div class="value" id="avgDuration">0:00</div>
      </div>
      <div class="stat-card">
        <h3>Below 30 Min</h3>
        <div class="subtitle">2min margin</div>
        <div class="value" id="belowThirty">0</div>
      </div>
    </div>

    <div class="section">
      <div class="section-header">
        <h2 id="pressTitle">All Pre Presses</h2>
        <button class="btn btn-export" onclick="exportToExcel()">Export</button>
      </div>
    </div>

    <div class="table-container" id="allPressesContainer">
      <div id="allPressLoadingContainer" class="loading">
        <div class="spinner"></div>
        <p>Loading data...</p>
        <p class="loading-quote" id="allPressLoadingQuote"></p>
      </div>
      <div class="all-press-stats" id="allPressStats"></div>
      <div class="all-presses-container" id="allPressesTables"></div>
    </div>

    <div class="table-container" id="singlePressContainer" style="display: none">
      <div id="loadingContainer" class="loading">
        <div class="spinner"></div>
        <p>Loading data...</p>
        <p class="loading-quote" id="singlePressLoadingQuote"></p>
      </div>
      <table id="dataTable" style="display: none">
        <thead>
          <tr>
            <th>DATE<br><small>dd-mm-yyyy</small></th>
            <th>START<br><small>hh:mm:ss</small></th>
            <th>END<br><small>hh:mm:ss</small></th>
            <th>DURATION<br><small>mm:ss</small></th>
            <th>IDLE<br><small>hh:mm:ss</small></th>
          </tr>
        </thead>
        <tbody id="tableBody"></tbody>
      </table>
      <div id="noDataContainer" class="no-data" style="display: none">
        <p>No data available for the selected date range.</p>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/flatpickr/4.6.13/flatpickr.min.js"></script>
  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyr8sSqhIin24puQuzh0yN4I1tJ5TXecoJPWBZPgiZ2toWy6Mk1HqtZxAO12cmAECqg/exec";

    const LOADING_QUOTES = [
      "Every step forward counts.",
      "Patience builds great results.",
      "Good things take a moment.",
      "Progress is happening.",
      "Stay hopeful; it's on the way.",
      "Great outcomes begin with small starts.",
      "Your wait will be worth it.",
      "Everything is aligning for you.",
      "Let the journey unfold.",
      "Believe in the process.",
      "We're moving forward—slowly but surely.",
      "Nothing great happens instantly.",
      "Trust the timing.",
      "You're closer than you think.",
      "The path is being prepared.",
      "Even delays have purpose.",
      "Patience is silent strength.",
      "Every moment builds something.",
      "Hold on—good is coming.",
      "One moment can change everything.",
      "Still faster than government paperwork.",
      "Loading… because teleportation isn't invented yet.",
      "Hold on… brewing digital coffee.",
      "Loading… please don't blink aggressively.",
      "We're not slow. You're just fast.",
      "Buffering… like my brain on Mondays.",
      "Loading… summoning the tech gods.",
      "Almost ready. The intern is running.",
      "Working… unlike my Wi-Fi sometimes.",
      "Loading… 99% done (just kidding).",
      "Preparing stuff you didn't ask for.",
      "Loading… trust the process. Or don't.",
      "We're making progress… somewhere.",
      "Just a sec… arguing with the server.",
      "Loading… praying nobody unplugged something.",
      "Almost there… finishing a long nap.",
      "Patience… we only broke one thing.",
      "Loading… chasing missing semicolons.",
      "Still loading… like your favorite game updates.",
      "Processing… please hold your applause.",
      "Compiling… don't disturb the electrons.",
      "Loading… optimizing algorithmic magic.",
      "Fetching data packets…",
      "Executing subroutines… standby.",
      "Loading… recalibrating system states.",
      "Synchronizing with server…",
      "De-referencing null expectations.",
      "Loading… avoiding race conditions.",
      "Hashing… encrypting… breathing.",
      "Pinging the universe for answers…",
      "Loading… aligning datasets.",
      "Debug mode: OFF (for now).",
      "Initiating background threads…",
      "Loading… rewriting logic on the fly.",
      "Running diagnostics… wait a sec.",
      "Performing handshake with reality.",
      "Loading… the CPU is doing cardio.",
      "Optimizing memory pathways.",
      "Loading… compressing inefficiency.",
      "Executing high-priority human patience request.",
      "Loading… aligning billions of table cells.",
      "Sorting columns… and my life.",
      "Loading rows… please don't count them.",
      "Formatting tables… the real boss fight.",
      "Fetching data… hope you like rows.",
      "Loading… because these tables don't fill themselves.",
      "Preparing rows, columns, chaos.",
      "Loading… ironing out wrinkled tables.",
      "Still loading… too many cells escaped.",
      "Summoning the Table Overlord…"
    ];

    function getRandomQuote() {
      return LOADING_QUOTES[Math.floor(Math.random() * LOADING_QUOTES.length)];
    }

    function updateLoadingQuotes() {
      document.getElementById("allPressLoadingQuote").textContent = getRandomQuote();
      document.getElementById("singlePressLoadingQuote").textContent = getRandomQuote();
    }

    let currentPress = "all";
    let allData = {};
    let todayStatusData = {}; // Store today's data for status indicators
    let fromDatePicker, toDatePicker;
    let darkMode = false;
    let fireflies = [];
    let orbs = [];
    let meteors = [];
    let meteorInterval = null;

    document.addEventListener("DOMContentLoaded", () => {
      updateDateTime();
      setInterval(updateDateTime, 1000);

      const today = new Date();
      
      // Initialize Flatpickr with explicit onChange to fix mobile issues
      fromDatePicker = flatpickr("#fromDate", {
        dateFormat: "d/m/Y",
        defaultDate: today,
        allowInput: false,
        clickOpens: true,
        disableMobile: false,
        onChange: function(selectedDates, dateStr, instance) {
          // Explicitly set the input value for mobile compatibility
          if (selectedDates.length > 0) {
            const d = selectedDates[0];
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            instance.input.value = `${day}/${month}/${year}`;
          }
        },
        onReady: function(selectedDates, dateStr, instance) {
          // Set initial value
          if (selectedDates.length > 0) {
            const d = selectedDates[0];
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            instance.input.value = `${day}/${month}/${year}`;
          }
        }
      });

      toDatePicker = flatpickr("#toDate", {
        dateFormat: "d/m/Y",
        defaultDate: today,
        allowInput: false,
        clickOpens: true,
        disableMobile: false,
        onChange: function(selectedDates, dateStr, instance) {
          // Explicitly set the input value for mobile compatibility
          if (selectedDates.length > 0) {
            const d = selectedDates[0];
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            instance.input.value = `${day}/${month}/${year}`;
          }
        },
        onReady: function(selectedDates, dateStr, instance) {
          // Set initial value
          if (selectedDates.length > 0) {
            const d = selectedDates[0];
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            instance.input.value = `${day}/${month}/${year}`;
          }
        }
      });

      initializePressButtons();
      loadData();
      
      // Load today's data for status indicators and refresh every 30 seconds
      loadTodayStatusData();
      setInterval(loadTodayStatusData, 30000);

      document.getElementById("themeToggle").addEventListener("click", toggleTheme);
      initializeLanternCursor();
    });

    // Fetch today's data specifically for status indicators
    async function loadTodayStatusData() {
      try {
        const today = new Date();
        const todayFormatted = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
        
        const promises = [];
        for (let press = 1; press <= 5; press++) {
          promises.push(fetchDataForPress(press, todayFormatted, todayFormatted));
        }
        
        const results = await Promise.all(promises);
        
        results.forEach((result, idx) => {
          todayStatusData[idx + 1] = result.records || [];
        });
        
        // Update status indicators based on today's data
        updatePressStatus();
      } catch (error) {
        console.error("Error loading today's status data:", error);
      }
    }

    function updateDateTime() {
      const now = new Date();
      const options = {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
      };
      document.getElementById("currentDateTime").textContent = now.toLocaleDateString("en-US", options);
    }

    function formatDateToYYYYMMDD(dateStr) {
      const parts = dateStr.split('/');
      if (parts.length !== 3) return '';
      return `${parts[2]}-${parts[1]}-${parts[0]}`;
    }

    function initializePressButtons() {
      const container = document.getElementById("pressButtons");
      container.innerHTML = "";

      const allBtn = document.createElement("button");
      allBtn.className = "press-btn active";
      allBtn.innerHTML = `<span class="status-indicator status-working"></span>All`;
      allBtn.onclick = () => selectPress("all");
      container.appendChild(allBtn);

      for (let i = 1; i <= 5; i++) {
        const btn = document.createElement("button");
        btn.className = "press-btn";
        btn.innerHTML = `<span class="status-indicator status-idle"></span>Press ${i}`;
        btn.onclick = () => selectPress(i);
        container.appendChild(btn);
      }
    }

    function selectPress(press) {
      currentPress = press;
      
      document.querySelectorAll(".press-btn").forEach((btn, idx) => {
        btn.classList.toggle("active", (idx === 0 && press === "all") || idx === press);
      });

      document.getElementById("pressTitle").textContent = 
        press === "all" ? "All Pre Presses" : `Pre Press - ${press}`;

      if (press === "all") {
        document.getElementById("singlePressContainer").style.display = "none";
        document.getElementById("allPressesContainer").style.display = "block";
        displayAllPresses();
      } else {
        document.getElementById("singlePressContainer").style.display = "block";
        document.getElementById("allPressesContainer").style.display = "none";
        displaySinglePress(press);
      }
    }

    async function loadData() {
      const fromDate = document.getElementById("fromDate").value;
      const toDate = document.getElementById("toDate").value;

      if (!fromDate || !toDate) {
        alert("Please select both dates.");
        return;
      }

      // Update loading quotes with random messages
      updateLoadingQuotes();

      // Show loading state for both sections
      document.getElementById("loadingContainer").style.display = "block";
      document.getElementById("dataTable").style.display = "none";
      document.getElementById("noDataContainer").style.display = "none";
      
      // Show loading for all presses section
      document.getElementById("allPressLoadingContainer").style.display = "block";
      document.getElementById("allPressStats").style.display = "none";
      document.getElementById("allPressesTables").style.display = "none";

      try {
        const fromFormatted = formatDateToYYYYMMDD(fromDate);
        const toFormatted = formatDateToYYYYMMDD(toDate);

        allData = {};
        const promises = [];

        for (let press = 1; press <= 5; press++) {
          promises.push(fetchDataForPress(press, fromFormatted, toFormatted));
        }

        const results = await Promise.all(promises);
        
        results.forEach((result, idx) => {
          allData[idx + 1] = result.records || [];
        });

        // Also load today's status data if not already loaded
        if (Object.keys(todayStatusData).length === 0) {
          await loadTodayStatusData();
        }

        updatePressStatus();

        if (currentPress === "all") {
          displayAllPresses();
        } else {
          displaySinglePress(currentPress);
        }

        // Hide loading states
        document.getElementById("loadingContainer").style.display = "none";
        document.getElementById("allPressLoadingContainer").style.display = "none";
      } catch (error) {
        console.error("Error loading data:", error);
        document.getElementById("loadingContainer").style.display = "none";
        document.getElementById("noDataContainer").style.display = "block";
        document.getElementById("allPressLoadingContainer").style.display = "none";
        document.getElementById("allPressStats").style.display = "grid";
        document.getElementById("allPressesTables").style.display = "grid";
      }
    }

    async function fetchDataForPress(press, fromDate, toDate) {
      try {
        const url = `${SCRIPT_URL}?action=getData&press=${press}&fromDate=${fromDate}&toDate=${toDate}`;
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        return await response.json();
      } catch (error) {
        console.error(`Error fetching press ${press}:`, error);
        return { records: [] };
      }
    }

    function displaySinglePress(press) {
      const data = allData[press] || [];
      const tbody = document.getElementById("tableBody");
      tbody.innerHTML = "";

      if (data.length === 0) {
        document.getElementById("loadingContainer").style.display = "none";
        document.getElementById("dataTable").style.display = "none";
        document.getElementById("noDataContainer").style.display = "block";
        return;
      }

      data.forEach((row, idx) => {
        const tr = document.createElement("tr");
        
        if (!row.endTime || row.endTime.trim() === '') {
          tr.classList.add("in-progress");
        } else {
          const duration = parseDuration(row.duration);
          if (duration >= 28 * 60) tr.classList.add("success");
          else if (duration >= 25 * 60) tr.classList.add("warning");
          else tr.classList.add("danger");
        }

        let idleStr = '00:00:00';
        if (idx < data.length - 1) {
          const prev = data[idx + 1];
          if (prev.endTime && prev.endTime.trim() !== '' && row.startTime) {
            const idle = calculateIdleTime(row.startTime, row.date, prev.endTime, prev.date);
            if (idle) idleStr = idle;
          }
        }

        tr.innerHTML = `
          <td>${row.date}</td>
          <td>${row.startTime}</td>
          <td>${row.endTime || "In Progress"}</td>
          <td class="duration ${getDurationClass(row.duration)}">${row.duration || "Pressing"}</td>
          <td class="idle-time">${idleStr}</td>
        `;
        tbody.appendChild(tr);
      });

      document.getElementById("loadingContainer").style.display = "none";
      document.getElementById("dataTable").style.display = "table";
      document.getElementById("noDataContainer").style.display = "none";

      updateStatsForPress(press);
    }

    function displayAllPresses() {
      const tables = document.getElementById("allPressesTables");
      const stats = document.getElementById("allPressStats");
      
      // Show the containers
      stats.style.display = "grid";
      tables.style.display = "grid";
      
      tables.innerHTML = "";
      stats.innerHTML = "";

      let total = 0, totalDur = 0, below30 = 0, working = 0;

      for (let press = 1; press <= 5; press++) {
        const data = allData[press] || [];
        const todayData = todayStatusData[press] || [];
        total += data.length;
        
        let pressDur = 0, pressBelow = 0;
        // Use today's data for working status (real-time)
        const pressWorking = todayData.some(row => !row.endTime || row.endTime.trim() === '');
        
        data.forEach(row => {
          const dur = parseDuration(row.duration);
          pressDur += dur;
          if (dur < 30 * 60) pressBelow++;
        });
        
        totalDur += pressDur;
        below30 += pressBelow;
        if (pressWorking) working++;

        const container = document.createElement("div");
        container.className = "mini-table-container";
        
        container.innerHTML = `
          <div class="mini-table-header">
            <span class="status-indicator ${pressWorking ? 'status-working' : 'status-idle'}"></span>
            Pre Press - ${press}
          </div>
          <table class="mini-table">
            <thead><tr><th>Date</th><th>Start</th><th>End</th><th>Duration</th></tr></thead>
            <tbody>
              ${data.slice(0, 3).map(row => `
                <tr>
                  <td>${row.date}</td>
                  <td>${row.startTime}</td>
                  <td>${row.endTime || "In Progress"}</td>
                  <td class="duration ${getDurationClass(row.duration)}">${row.duration || "Pressing"}</td>
                </tr>
              `).join('')}
              ${data.length > 3 ? `<tr><td colspan="4" class="more-entries" onclick="expandPress(${press})">+${data.length - 3} more</td></tr>` : ''}
              ${data.length === 0 ? '<tr><td colspan="4" class="no-data-cell" style="text-align:center;padding:20px;">No data</td></tr>' : ''}
            </tbody>
          </table>
        `;
        tables.appendChild(container);
      }

      const avg = total > 0 ? formatDuration(totalDur / total) : "0:00";
      
      document.getElementById("totalPresses").textContent = total;
      document.getElementById("avgDuration").textContent = avg;
      document.getElementById("belowThirty").textContent = below30;
      
      stats.innerHTML = `
        <div class="all-stat-card"><h4>Total Entries</h4><div class="value">${total}</div></div>
        <div class="all-stat-card"><h4>Avg Duration</h4><div class="value">${avg}</div></div>
        <div class="all-stat-card"><h4>Below 30 Min</h4><div class="value">${below30}</div></div>
        <div class="all-stat-card"><h4>Working</h4><div class="value">${working}/5</div></div>
      `;
    }

    function expandPress(num) {
      selectPress(num);
      document.getElementById('singlePressContainer').scrollIntoView({ behavior: 'smooth' });
    }

    function updateStatsForPress(press) {
      const data = allData[press] || [];
      let totalDur = 0, below30 = 0;
      
      data.forEach(row => {
        const dur = parseDuration(row.duration);
        totalDur += dur;
        if (dur < 30 * 60) below30++;
      });
      
      document.getElementById("totalPresses").textContent = data.length;
      document.getElementById("avgDuration").textContent = data.length > 0 ? formatDuration(totalDur / data.length) : "0:00";
      document.getElementById("belowThirty").textContent = below30;
    }

    function updatePressStatus() {
      // Use todayStatusData for real-time status indicators (always based on today's data)
      for (let press = 1; press <= 5; press++) {
        const data = todayStatusData[press] || [];
        // Check if there's any entry with no end time (currently in progress)
        const isWorking = data.some(row => !row.endTime || row.endTime.trim() === '');
        
        // Update status indicator in press buttons
        const btns = document.querySelectorAll(".press-btn");
        if (btns[press]) {
          const ind = btns[press].querySelector(".status-indicator");
          if (ind) ind.className = `status-indicator ${isWorking ? 'status-working' : 'status-idle'}`;
        }
      }
    }

    function parseDuration(str) {
      if (!str) return 0;
      const parts = str.split(':');
      return parts.length === 2 ? parseInt(parts[0]) * 60 + parseInt(parts[1]) : 0;
    }

    function formatDuration(secs) {
      const m = Math.floor(secs / 60);
      const s = Math.floor(secs % 60);
      return `${m}:${s < 10 ? '0' : ''}${s}`;
    }

    function getDurationClass(str) {
      const dur = parseDuration(str);
      if (!str || str === "Pressing") return "in-progress";
      if (dur >= 28 * 60) return "success";
      if (dur >= 25 * 60) return "warning";
      return "danger";
    }

    function calculateIdleTime(currStart, currDate, prevEnd, prevDate) {
      if (!prevEnd || !currStart) return null;
      
      const currParts = currDate.split('/');
      const prevParts = prevDate.split('/');
      
      const curr = new Date(currParts[2], currParts[1] - 1, currParts[0]);
      const prev = new Date(prevParts[2], prevParts[1] - 1, prevParts[0]);
      
      const currTime = currStart.split(':').map(Number);
      const prevTime = prevEnd.split(':').map(Number);
      
      curr.setHours(currTime[0] || 0, currTime[1] || 0, currTime[2] || 0, 0);
      prev.setHours(prevTime[0] || 0, prevTime[1] || 0, prevTime[2] || 0, 0);
      
      const diffSec = Math.floor((curr - prev) / 1000);
      if (diffSec < 0) return null;
      
      const h = Math.floor(diffSec / 3600);
      const m = Math.floor((diffSec % 3600) / 60);
      const s = diffSec % 60;
      
      return `${String(h).padStart(2, '0')}:${String(m).padStart(2, '0')}:${String(s).padStart(2, '0')}`;
    }

    function exportToExcel() {
      const fromDate = document.getElementById("fromDate").value;
      const toDate = document.getElementById("toDate").value;
      
      let csvContent = "";
      let filename = "";
      
      if (currentPress === "all") {
        // Export all presses data
        filename = `All_Presses_${fromDate.replace(/\//g, '-')}_to_${toDate.replace(/\//g, '-')}.csv`;
        csvContent = "Press,Date,Start Time,End Time,Duration\n";
        
        for (let press = 1; press <= 5; press++) {
          const data = allData[press] || [];
          data.forEach(row => {
            csvContent += `Press ${press},${row.date},${row.startTime},${row.endTime || "In Progress"},${row.duration || "Pressing"}\n`;
          });
        }
      } else {
        // Export single press data
        filename = `Press_${currentPress}_${fromDate.replace(/\//g, '-')}_to_${toDate.replace(/\//g, '-')}.csv`;
        csvContent = "Date,Start Time,End Time,Duration,Idle Time\n";
        
        const data = allData[currentPress] || [];
        data.forEach((row, idx) => {
          let idleStr = '00:00:00';
          if (idx < data.length - 1) {
            const prev = data[idx + 1];
            if (prev.endTime && prev.endTime.trim() !== '' && row.startTime) {
              const idle = calculateIdleTime(row.startTime, row.date, prev.endTime, prev.date);
              if (idle) idleStr = idle;
            }
          }
          csvContent += `${row.date},${row.startTime},${row.endTime || "In Progress"},${row.duration || "Pressing"},${idleStr}\n`;
        });
      }
      
      // Check if there's data to export
      if (csvContent.split('\n').length <= 2) {
        alert("No data available to export.");
        return;
      }
      
      // Create and download the CSV file
      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      
      if (navigator.msSaveBlob) {
        // IE 10+
        navigator.msSaveBlob(blob, filename);
      } else {
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute("download", filename);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      }
    }

    function toggleTheme() {
      darkMode = !darkMode;
      document.body.classList.toggle("dark-mode", darkMode);
      
      if (darkMode) createCelestialEffects();
      else removeCelestialEffects();
    }

    function createCelestialEffects() {
      for (let i = 0; i < 15; i++) createFirefly();
      for (let i = 0; i < 5; i++) createOrb();
      meteorInterval = setInterval(createMeteor, 2000);
    }

    function removeCelestialEffects() {
      document.querySelectorAll('.firefly, .orb, .meteor').forEach(el => el.remove());
      if (meteorInterval) clearInterval(meteorInterval);
      fireflies = [];
      orbs = [];
      meteors = [];
    }

    function createFirefly() {
      const el = document.createElement('div');
      el.className = 'firefly';
      document.body.appendChild(el);
      
      el.style.left = `${Math.random() * window.innerWidth}px`;
      el.style.top = `${Math.random() * window.innerHeight}px`;
      
      const anim = el.animate([
        { transform: 'translate(0, 0)', opacity: 0 },
        { transform: `translate(${Math.random() * 100 - 50}px, ${Math.random() * 100 - 50}px)`, opacity: 0.8 },
        { transform: `translate(${Math.random() * 100 - 50}px, ${Math.random() * 100 - 50}px)`, opacity: 0 }
      ], { duration: 3000 + Math.random() * 4000, iterations: Infinity, easing: 'ease-in-out' });
      
      fireflies.push({ element: el, animation: anim });
    }

    function createOrb() {
      const el = document.createElement('div');
      el.className = 'orb';
      document.body.appendChild(el);
      
      const size = 40 + Math.random() * 80;
      el.style.width = `${size}px`;
      el.style.height = `${size}px`;
      el.style.left = `${Math.random() * window.innerWidth}px`;
      el.style.top = `${Math.random() * window.innerHeight}px`;
      
      const anim = el.animate([
        { transform: 'translate(0, 0)', opacity: 0.1 },
        { transform: `translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px)`, opacity: 0.4 },
        { transform: `translate(${Math.random() * 200 - 100}px, ${Math.random() * 200 - 100}px)`, opacity: 0.1 }
      ], { duration: 10000 + Math.random() * 15000, iterations: Infinity, easing: 'ease-in-out' });
      
      orbs.push({ element: el, animation: anim });
    }

    function createMeteor() {
      const el = document.createElement('div');
      el.className = 'meteor';
      document.body.appendChild(el);
      
      el.style.left = `${Math.random() * window.innerWidth}px`;
      el.style.top = '-50px';
      
      const dist = 300 + Math.random() * 400;
      const anim = el.animate([
        { transform: 'translate(0, 0) rotate(-45deg)', opacity: 0 },
        { transform: `translate(${dist}px, ${dist}px) rotate(-45deg)`, opacity: 1 },
        { transform: `translate(${dist * 1.2}px, ${dist * 1.2}px) rotate(-45deg)`, opacity: 0 }
      ], { duration: 1000 + Math.random() * 2000, iterations: 1, easing: 'ease-in' });
      
      anim.onfinish = () => el.remove();
      meteors.push(el);
    }

    function initializeLanternCursor() {
      const lantern = document.getElementById('lanternCursor');
      
      document.addEventListener('mousemove', (e) => {
        lantern.style.left = `${e.clientX - 20}px`;
        lantern.style.top = `${e.clientY - 30}px`;
        
        if (darkMode) {
          const repel = document.createElement('div');
          repel.className = 'repel-effect';
          repel.style.left = `${e.clientX - 50}px`;
          repel.style.top = `${e.clientY - 50}px`;
          document.body.appendChild(repel);
          
          const anim = repel.animate([
            { transform: 'scale(0.5)', opacity: 0.6 },
            { transform: 'scale(1.5)', opacity: 0 }
          ], { duration: 800, easing: 'ease-out' });
          
          anim.onfinish = () => repel.remove();
        }
      });
    }
  </script>
</body>
</html>
